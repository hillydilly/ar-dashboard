<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A&R Dashboard</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233b82f6'/%3E%3Cstop offset='100%25' style='stop-color:%238b5cf6'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='68' text-anchor='middle' fill='white' font-family='system-ui' font-weight='bold' font-size='40'%3EA%26R%3C/text%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{--bg-1:#fafafa;--bg-2:#fff;--bg-3:#f4f4f5;--bg-h:#e4e4e7;--tx-1:#18181b;--tx-2:#52525b;--tx-3:#a1a1aa;--bd:#e4e4e7;--bd-l:#f4f4f5;--acc:#2563eb;--acc-l:#dbeafe;--grn:#10b981;--grn-l:#d1fae5;--red:#ef4444;--red-l:#fee2e2;--prp:#8b5cf6;--prp-l:#ede9fe;--org:#f59e0b;--org-l:#fef3c7}
    [data-theme="dark"]{--bg-1:#09090b;--bg-2:#18181b;--bg-3:#27272a;--bg-h:#3f3f46;--tx-1:#fafafa;--tx-2:#a1a1aa;--tx-3:#71717a;--bd:#27272a;--bd-l:#3f3f46;--acc:#3b82f6;--acc-l:rgba(59,130,246,.15);--grn:#10b981;--grn-l:rgba(16,185,129,.15);--red:#ef4444;--red-l:rgba(239,68,68,.15);--prp:#a78bfa;--prp-l:rgba(139,92,246,.15);--org:#fbbf24;--org-l:rgba(251,191,36,.15)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Plus Jakarta Sans',-apple-system,sans-serif;background:var(--bg-1);color:var(--tx-1);min-height:100vh;transition:background .3s,color .3s}
    input,button,select{font-family:inherit}input:focus{outline:none;border-color:var(--acc)!important}
    select{padding:8px 12px;border-radius:8px;border:1px solid var(--bd);background:var(--bg-3);color:var(--tx-1);font-size:12px;cursor:pointer}
    ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
    .ld{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;gap:16px}
    .sp{width:36px;height:36px;border:3px solid var(--bd);border-top-color:var(--acc);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fi{animation:fadeIn .4s ease-out forwards}
    .mono{font-family:'JetBrains Mono',monospace}
    .clickable{cursor:pointer;transition:transform .1s,box-shadow .2s}.clickable:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.08)}
    @media(max-width:600px){.hide-mobile{display:none!important}.mobile-full{grid-template-columns:1fr!important}}
    @media(min-width:601px){.show-mobile{display:none!important}}
  </style>
</head>
<body>
<div id="root"><div class="ld"><div class="sp"></div><span style="color:var(--tx-3);font-size:14px">Loading...</span></div></div>
<script>
const FIREBASE_CONFIG={apiKey:"AIzaSyAI2Nrt4PsnOB0DyLa4yrWYyY39Oblzcec",authDomain:"ar-scouting-dashboard.firebaseapp.com",projectId:"ar-scouting-dashboard",storageBucket:"ar-scouting-dashboard.firebasestorage.app",messagingSenderId:"290834477922",appId:"1:290834477922:web:979499b51ba18607f0f23b"};
let db=null;
function initFirebase(){try{firebase.initializeApp(FIREBASE_CONFIG);db=firebase.firestore();return true}catch(e){console.error(e);return false}}
const FS={
  async load(){if(!db)return[];try{const s=await db.collection('artists').get();return s.docs.map(d=>({id:d.id,...d.data()}))}catch(e){console.error(e);return[]}},
  async save(a){if(!db)return false;try{const{id,...data}=a;await db.collection('artists').doc(id).set(data,{merge:true});return true}catch(e){console.error(e);return false}},
  async del(id){if(!db)return false;try{await db.collection('artists').doc(id).delete();return true}catch(e){console.error(e);return false}},
  sub(cb){if(!db)return()=>{};return db.collection('artists').onSnapshot(s=>{cb(s.docs.map(d=>({id:d.id,...d.data()})))},e=>console.error(e))}
};
window.FS=FS;
</script>
<script type="text/babel">
const{useState,useEffect,useMemo}=React;

// Utilities
const fmt=n=>{if(!n||n===0)return'0';if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return n.toLocaleString()};
const fmtD=n=>{if(!n||n===0)return'0';const a=Math.abs(n),p=n>=0?'+':'-';if(a>=1e6)return p+(a/1e6).toFixed(1)+'M';if(a>=1e3)return p+(a/1e3).toFixed(1)+'K';return p+a.toLocaleString()};
const vel=(h,d=1)=>{if(!h||h.length<2)return 0;return(h[h.length-1]?.v||0)-(h[Math.max(0,h.length-1-d)]?.v||0)};
const timeAgo=d=>{if(!d)return'Never';const now=new Date(),then=new Date(d),diff=Math.floor((now-then)/1000);if(diff<60)return'Just now';if(diff<3600)return Math.floor(diff/60)+'m ago';if(diff<86400)return Math.floor(diff/3600)+'h ago';return Math.floor(diff/86400)+'d ago';};

// Stream calculations - Spotify + YouTube views per song
const getSpotifyStreams=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+(x.st||0),0):0;
const getYTViews=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+(x.yt||0),0):0;
const totStr=a=>getSpotifyStreams(a)+getYTViews(a);
const totTkUGC=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+(x.ug||0),0):0;
const totIgUGC=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+(x.igu||0),0):0;
const totUGC=a=>totTkUGC(a)+totIgUGC(a);
const dayStr=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+vel(x.h?.st,1)+vel(x.h?.yt,1),0):0;
const weekStr=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+vel(x.h?.st,7)+vel(x.h?.yt,7),0):0;
const dayTkUGC=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+vel(x.h?.ug,1),0):0;
const dayIgUGC=a=>a.sm?Object.values(a.sm).reduce((s,x)=>s+vel(x.h?.igu,1),0):0;
const dayUGC=a=>dayTkUGC(a)+dayIgUGC(a);

// Get last updated timestamp from artist data
const getLastUpdated=a=>{
  // Check for explicit lastUpdated timestamp first
  if(a.lastUpdated) return a.lastUpdated;
  
  let latest=null;
  
  // Check song metrics history
  if(a.sm){
    Object.values(a.sm).forEach(m=>{
      ['st','yt','ug'].forEach(k=>{
        const h=m.h?.[k];
        if(h&&h.length>0){
          const last=h[h.length-1]?.d;
          if(last&&(!latest||last>latest))latest=last;
        }
      });
    });
  }
  
  // Check social history (followers, posts)
  ['tk','ig','sf','yt','tpt','ipt'].forEach(k=>{
    const h=a.h?.[k];
    if(h&&h.length>0){
      const last=h[h.length-1]?.d;
      if(last&&(!latest||last>latest))latest=last;
    }
  });
  
  return latest;
};

// Icons
const I={
  sun:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
  moon:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
  plus:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  search:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
  up:<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="18 15 12 9 6 15"/></svg>,
  down:<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="6 9 12 15 18 9"/></svg>,
  ext:<svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
  chev:<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
  back:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
  trash:<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
  edit:<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
  x:<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  fire:<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 23c-4.97 0-9-3.58-9-8 0-3.31 2.69-6.14 5-8 0 2.76 2.24 5 5 5s4-1.34 4-3c1.5 1.5 3 4 3 6 0 4.42-4.03 8-8 8z"/></svg>,
  clock:<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
  sp:<svg width="15" height="15" viewBox="0 0 24 24" fill="#1DB954"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02z"/></svg>,
  tk:<svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64V9.4A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4z"/></svg>,
  ig:<svg width="15" height="15" viewBox="0 0 24 24" fill="#E1306C"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0z"/></svg>,
  yt:<svg width="15" height="15" viewBox="0 0 24 24" fill="#FF0000"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/></svg>,
  am:<svg width="15" height="15" viewBox="0 0 24 24" fill="#FA243C"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.586 14.424c-.18.295-.563.387-.857.207-2.35-1.434-5.305-1.76-8.786-.963-.335.077-.67-.133-.746-.47-.077-.334.132-.67.47-.745 3.808-.87 7.076-.496 9.712 1.115.293.18.386.563.206.856z"/></svg>,
};

// Components
const Spark=({data,h=26})=>{
  if(!data||data.length<2)return<div style={{width:70,height:h}}/>;
  const vs=data.map(d=>d.v||0),mn=Math.min(...vs),mx=Math.max(...vs),rg=mx-mn||1,w=70;
  const pts=vs.map((v,i)=>`${(i/(vs.length-1))*w},${h-((v-mn)/rg)*(h-4)-2}`).join(' ');
  const up=vs[vs.length-1]>=vs[0];
  const c=up?'var(--grn)':'var(--red)';
  return<svg width={w} height={h}><polygon points={`0,${h} ${pts} ${w},${h}`} fill={c} fillOpacity=".12"/><polyline points={pts} fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"/></svg>;
};

const Delta=({v,sz='md'})=>{
  const pos=v>=0,zero=v===0;
  const s={sm:{fs:11,p:'2px 6px'},md:{fs:12,p:'3px 8px'}}[sz];
  return<span className="mono" style={{display:'inline-flex',alignItems:'center',gap:2,padding:s.p,borderRadius:6,fontSize:s.fs,fontWeight:600,background:zero?'var(--bg-3)':pos?'var(--grn-l)':'var(--red-l)',color:zero?'var(--tx-3)':pos?'var(--grn)':'var(--red)'}}>{!zero&&(pos?I.up:I.down)}{fmtD(v)}</span>;
};

const PBadge=({p,url})=>{
  if(!url)return null;
  const icons={sp:I.sp,tk:I.tk,ig:I.ig,yt:I.yt,am:I.am};
  const labels={sp:'Spotify',tk:'TikTok',ig:'Instagram',yt:'YouTube',am:'Apple Music'};
  return<a href={url} target="_blank" rel="noopener" style={{display:'inline-flex',alignItems:'center',gap:5,padding:'5px 9px',borderRadius:7,background:'var(--bg-3)',color:'var(--tx-2)',fontSize:11,fontWeight:500,textDecoration:'none',transition:'background .15s'}} onMouseOver={e=>e.currentTarget.style.background='var(--bg-h)'} onMouseOut={e=>e.currentTarget.style.background='var(--bg-3)'}>{icons[p]}{labels[p]}{I.ext}</a>;
};

// Clickable Stat Card
const Stat=({label,value,delta,icon,color,spark,onClick})=>(
  <div className={onClick?"clickable":""} onClick={onClick} style={{padding:14,borderRadius:12,background:'var(--bg-2)',border:'1px solid var(--bd)'}}>
    <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:6}}>
      <span style={{fontSize:10,fontWeight:600,color:'var(--tx-3)',textTransform:'uppercase',letterSpacing:'.5px'}}>{label}</span>
      <div style={{display:'flex',alignItems:'center',gap:4}}>
        {icon&&<span style={{color}}>{icon}</span>}
        {onClick&&<span style={{color:'var(--acc)',fontSize:10}}>View â€º</span>}
      </div>
    </div>
    <div className="mono" style={{fontSize:24,fontWeight:700,color,marginBottom:6}}>{value}</div>
    <div style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
      {delta!==undefined&&<Delta v={delta} sz="sm"/>}
      {spark&&<Spark data={spark} h={20}/>}
    </div>
  </div>
);

// Stats Detail Modal - Spotify + YouTube breakdown
function StatsModal({title,artist,type,onClose}){
  const data=useMemo(()=>{
    const a=artist;
    if(type==='streams'){
      const spotify=getSpotifyStreams(a);
      const youtube=getYTViews(a);
      const total=spotify+youtube;
      const daily=dayStr(a);
      const weekly=weekStr(a);
      return{total,daily,weekly,spotify,youtube,desc:'Combined streams from Spotify and YouTube'};
    }
    if(type==='monthly'){
      const total=a.m?.ml||0;
      const daily=vel(a.h?.ml,1);
      const weekly=vel(a.h?.ml,7);
      return{total,daily,weekly,history:a.h?.ml,desc:'Spotify monthly listeners. This metric updates when you run the extension.'};
    }
    if(type==='youtube'){
      const total=a.m?.yt||0;
      const daily=vel(a.h?.yt,1);
      const weekly=vel(a.h?.yt,7);
      return{total,daily,weekly,history:a.h?.yt,desc:'YouTube channel subscribers.'};
    }
    if(type==='tiktok'){
      const total=a.m?.tk||0;
      const daily=vel(a.h?.tk,1);
      const weekly=vel(a.h?.tk,7);
      const postsWk=a.m?.tp||0;
      return{total,daily,weekly,postsWk,history:a.h?.tk,desc:'Total TikTok followers'};
    }
    if(type==='instagram'){
      const total=a.m?.ig||0;
      const daily=vel(a.h?.ig,1);
      const weekly=vel(a.h?.ig,7);
      const postsWk=a.m?.ip||0;
      return{total,daily,weekly,postsWk,history:a.h?.ig,desc:'Total Instagram followers'};
    }
    if(type==='ugc'){
      const tkUgc=totTkUGC(a);
      const igUgc=totIgUGC(a);
      const total=tkUgc+igUgc;
      const daily=dayUGC(a);
      return{total,daily,weekly:0,tkUgc,igUgc,desc:'Total videos using artist sounds across TikTok and Instagram Reels.'};
    }
    if(type==='social'){
      // Calculate posts per day/week/month from history
      const getPostVelocity = (history, days) => {
        if (!history || history.length < 2) return 0;
        const sorted = [...history].sort((a,b) => a.d.localeCompare(b.d));
        const latest = sorted[sorted.length - 1];
        const targetDate = new Date();
        targetDate.setDate(targetDate.getDate() - days);
        const targetStr = targetDate.toISOString().split('T')[0];
        let oldEntry = sorted.find(h => h.d <= targetStr);
        if (!oldEntry) oldEntry = sorted[0];
        return Math.max(0, (latest.v || 0) - (oldEntry.v || 0));
      };
      
      const tkTotal = a.m?.tpt || 0;
      const igTotal = a.m?.ipt || 0;
      const tkDay = getPostVelocity(a.h?.tpt, 1);
      const tkWeek = getPostVelocity(a.h?.tpt, 7);
      const tkMonth = getPostVelocity(a.h?.tpt, 30);
      const igDay = getPostVelocity(a.h?.ipt, 1);
      const igWeek = getPostVelocity(a.h?.ipt, 7);
      const igMonth = getPostVelocity(a.h?.ipt, 30);
      
      return{
        total: a.m?.ss || 0,
        tkTotal, igTotal,
        tkDay, tkWeek, tkMonth,
        igDay, igWeek, igMonth,
        desc:'Social Score based on TikTok and Instagram posting consistency (0-10 scale). Run extension daily to track posting velocity.'
      };
    }
    return{total:0,daily:0,weekly:0,desc:''};
  },[artist,type]);

  return(
    <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,.55)',backdropFilter:'blur(4px)',display:'flex',alignItems:'center',justifyContent:'center',padding:16,zIndex:1000}} onClick={onClose}>
      <div style={{width:'100%',maxWidth:500,background:'var(--bg-2)',borderRadius:14,border:'1px solid var(--bd)',overflow:'hidden'}} onClick={e=>e.stopPropagation()}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'14px 18px',borderBottom:'1px solid var(--bd)'}}>
          <h2 style={{fontSize:16,fontWeight:600}}>{title}</h2>
          <button onClick={onClose} style={{padding:6,borderRadius:6,border:'none',background:'var(--bg-3)',color:'var(--tx-3)',cursor:'pointer'}}>{I.x}</button>
        </div>
        <div style={{padding:18}}>
          <p style={{fontSize:12,color:'var(--tx-3)',marginBottom:16,lineHeight:1.5}}>{data.desc}</p>
          
          {/* Main stats */}
          <div style={{display:'grid',gridTemplateColumns:type==='social'?'1fr':'1fr 1fr 1fr',gap:10,marginBottom:16}}>
            {type==='social'?(
              <div style={{padding:16,borderRadius:10,background:'var(--acc-l)',textAlign:'center'}}>
                <div style={{fontSize:10,color:'var(--acc)',textTransform:'uppercase',marginBottom:4}}>Social Score</div>
                <div className="mono" style={{fontSize:32,fontWeight:700,color:'var(--acc)'}}>{data.total}/10</div>
              </div>
            ):(
              <>
                <div style={{padding:12,borderRadius:10,background:'var(--bg-3)',textAlign:'center'}}>
                  <div style={{fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',marginBottom:4}}>All Time</div>
                  <div className="mono" style={{fontSize:20,fontWeight:700}}>{fmt(data.total)}</div>
                </div>
                <div style={{padding:12,borderRadius:10,background:'var(--bg-3)',textAlign:'center'}}>
                  <div style={{fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',marginBottom:4}}>This Week</div>
                  <div className="mono" style={{fontSize:20,fontWeight:700,color:data.weekly>=0?'var(--grn)':'var(--red)'}}>{fmtD(data.weekly)}</div>
                </div>
                <div style={{padding:12,borderRadius:10,background:'var(--bg-3)',textAlign:'center'}}>
                  <div style={{fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',marginBottom:4}}>Today</div>
                  <div className="mono" style={{fontSize:20,fontWeight:700,color:data.daily>=0?'var(--grn)':'var(--red)'}}>{fmtD(data.daily)}</div>
                </div>
              </>
            )}
          </div>

          {/* DSP Breakdown for streams - Spotify + YouTube */}
          {type==='streams'&&(
            <div>
              <h3 style={{fontSize:12,fontWeight:600,color:'var(--tx-2)',marginBottom:10}}>Breakdown by Platform</h3>
              <div style={{display:'flex',flexDirection:'column',gap:8}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>{I.sp}<span style={{fontSize:13}}>Spotify</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.spotify)}</span>
                </div>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>{I.yt}<span style={{fontSize:13}}>YouTube</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.youtube)}</span>
                </div>
              </div>
            </div>
          )}

          {/* Posts per week for social platforms */}
          {(type==='tiktok'||type==='instagram')&&data.postsWk!==undefined&&(
            <div style={{padding:12,borderRadius:10,background:'var(--acc-l)',marginTop:8}}>
              <div style={{fontSize:10,color:'var(--acc)',textTransform:'uppercase',marginBottom:4}}>Posts/Week</div>
              <div className="mono" style={{fontSize:20,fontWeight:700,color:'var(--acc)'}}>{data.postsWk}</div>
            </div>
          )}

          {/* UGC breakdown - TikTok + Instagram */}
          {type==='ugc'&&(
            <div>
              <h3 style={{fontSize:12,fontWeight:600,color:'var(--tx-2)',marginBottom:10}}>Breakdown by Platform</h3>
              <div style={{display:'flex',flexDirection:'column',gap:8}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>{I.tk}<span style={{fontSize:13}}>TikTok UGC</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.tkUgc||0)}</span>
                </div>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>{I.ig}<span style={{fontSize:13}}>Instagram Reels</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.igUgc||0)}</span>
                </div>
              </div>
              <p style={{fontSize:10,color:'var(--tx-3)',marginTop:10}}>TikTok: Tap UGC on songs to update. Instagram: Add sound URL and run extension to auto-capture.</p>
            </div>
          )}

          {/* History chart for metrics with history data */}
          {data.history&&data.history.length>1&&(
            <div style={{marginTop:16}}>
              <h3 style={{fontSize:12,fontWeight:600,color:'var(--tx-2)',marginBottom:10}}>History (Last {Math.min(data.history.length,30)} days)</h3>
              <div style={{background:'var(--bg-3)',borderRadius:10,padding:12}}>
                <Spark data={data.history.slice(-30)} h={60}/>
                <div style={{display:'flex',justifyContent:'space-between',marginTop:8,fontSize:10,color:'var(--tx-3)'}}>
                  <span>{data.history.length>1?data.history[Math.max(0,data.history.length-30)]?.d:''}</span>
                  <span>{data.history[data.history.length-1]?.d}</span>
                </div>
              </div>
            </div>
          )}

          {/* Social score breakdown */}
          {type==='social'&&(
            <div>
              <h3 style={{fontSize:12,fontWeight:600,color:'var(--tx-2)',marginBottom:10}}>Total Posts</h3>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginBottom:16}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>{I.tk}<span style={{fontSize:12}}>TikTok</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.tkTotal)}</span>
                </div>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 12px',borderRadius:8,background:'var(--bg-3)'}}>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>{I.ig}<span style={{fontSize:12}}>Instagram</span></div>
                  <span className="mono" style={{fontWeight:600}}>{fmt(data.igTotal)}</span>
                </div>
              </div>
              
              <h3 style={{fontSize:12,fontWeight:600,color:'var(--tx-2)',marginBottom:10}}>Posting Velocity</h3>
              <div style={{background:'var(--bg-3)',borderRadius:10,overflow:'hidden'}}>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:1,background:'var(--bd)'}}>
                  <div style={{padding:'8px',background:'var(--bg-3)',fontSize:10,color:'var(--tx-3)',textTransform:'uppercase'}}></div>
                  <div style={{padding:'8px',background:'var(--bg-3)',fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',textAlign:'center'}}>Day</div>
                  <div style={{padding:'8px',background:'var(--bg-3)',fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',textAlign:'center'}}>Week</div>
                  <div style={{padding:'8px',background:'var(--bg-3)',fontSize:10,color:'var(--tx-3)',textTransform:'uppercase',textAlign:'center'}}>Month</div>
                </div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:1,background:'var(--bd)'}}>
                  <div style={{padding:'10px 8px',background:'var(--bg-2)',display:'flex',alignItems:'center',gap:4}}>{I.tk}<span style={{fontSize:11}}>TikTok</span></div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.tkDay>0?'var(--grn)':'var(--tx-3)'}}>{data.tkDay||'â€”'}</div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.tkWeek>0?'var(--grn)':'var(--tx-3)'}}>{data.tkWeek||'â€”'}</div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.tkMonth>0?'var(--grn)':'var(--tx-3)'}}>{data.tkMonth||'â€”'}</div>
                </div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:1,background:'var(--bd)'}}>
                  <div style={{padding:'10px 8px',background:'var(--bg-2)',display:'flex',alignItems:'center',gap:4}}>{I.ig}<span style={{fontSize:11}}>Instagram</span></div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.igDay>0?'var(--grn)':'var(--tx-3)'}}>{data.igDay||'â€”'}</div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.igWeek>0?'var(--grn)':'var(--tx-3)'}}>{data.igWeek||'â€”'}</div>
                  <div className="mono" style={{padding:'10px 8px',background:'var(--bg-2)',textAlign:'center',fontWeight:600,color:data.igMonth>0?'var(--grn)':'var(--tx-3)'}}>{data.igMonth||'â€”'}</div>
                </div>
              </div>
              
              <div style={{marginTop:12,padding:10,borderRadius:8,background:'var(--acc-l)',fontSize:11,color:'var(--acc)'}}>
                ðŸ’¡ Velocity is calculated from post count history. Run the extension daily for accurate tracking.
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// Main App
function App(){
  const[artists,setArtists]=useState([]);
  const[loading,setLoading]=useState(true);
  const[sel,setSel]=useState(null);
  const[showAdd,setShowAdd]=useState(false);
  const[search,setSearch]=useState('');
  const[sortBy,setSortBy]=useState('streams');
  const[theme,setTheme]=useState(()=>localStorage.getItem('ar-theme')||'dark');
  const[statsModal,setStatsModal]=useState(null);

  useEffect(()=>{initFirebase();const unsub=FS.sub(d=>{setArtists(d);setLoading(false)});return()=>unsub()},[]);
  useEffect(()=>{document.documentElement.setAttribute('data-theme',theme);localStorage.setItem('ar-theme',theme)},[theme]);

  const toggle=()=>setTheme(t=>t==='dark'?'light':'dark');
  const save=async a=>await FS.save(a);
  const add=async d=>{const n={...d,id:Date.now().toString(),sg:[],sm:{},h:{sf:[],tk:[],ig:[],yt:[]}};await save(n);setShowAdd(false)};
  const del=async id=>{if(confirm('Remove this artist?')){await FS.del(id);if(sel?.id===id)setSel(null)}};

  const filtered=useMemo(()=>{if(!search)return artists;const q=search.toLowerCase();return artists.filter(a=>a.n?.toLowerCase().includes(q))},[artists,search]);
  
  const sorted=useMemo(()=>{
    return[...filtered].sort((a,b)=>{
      if(sortBy==='name')return(a.n||'').localeCompare(b.n||'');
      if(sortBy==='date')return new Date(b.da||0)-new Date(a.da||0);
      if(sortBy==='velocity')return dayStr(b)-dayStr(a);
      if(sortBy==='tiktok')return(b.m?.tk||0)-(a.m?.tk||0);
      if(sortBy==='ugc')return totUGC(b)-totUGC(a);
      return totStr(b)-totStr(a); // default: streams
    });
  },[filtered,sortBy]);

  // Get global last updated
  const lastUpdated=useMemo(()=>{
    let latest=null;
    artists.forEach(a=>{
      const lu=getLastUpdated(a);
      if(lu&&(!latest||lu>latest))latest=lu;
    });
    return latest;
  },[artists]);

  if(loading)return<div className="ld"><div className="sp"></div><span style={{color:'var(--tx-3)',fontSize:14}}>Loading...</span></div>;

  return(
    <div style={{minHeight:'100vh'}}>
      {/* Header */}
      <header style={{position:'sticky',top:0,zIndex:100,background:'var(--bg-2)',borderBottom:'1px solid var(--bd)',padding:'10px 20px'}}>
        <div style={{maxWidth:1400,margin:'0 auto',display:'flex',alignItems:'center',justifyContent:'space-between',gap:12,flexWrap:'wrap'}}>
          <div style={{display:'flex',alignItems:'center',gap:16}}>
            <h1 style={{fontSize:17,fontWeight:700,display:'flex',alignItems:'center',gap:10}}>
              <svg width="32" height="32" viewBox="0 0 100 100">
                <defs><linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style={{stopColor:'#3b82f6'}}/><stop offset="100%" style={{stopColor:'#8b5cf6'}}/></linearGradient></defs>
                <rect width="100" height="100" rx="20" fill="url(#logoGrad)"/>
                <text x="50" y="68" textAnchor="middle" fill="white" fontFamily="system-ui" fontWeight="bold" fontSize="40">A&R</text>
              </svg>
              <span className="hide-mobile">Dashboard</span>
            </h1>
            {sel&&<button onClick={()=>setSel(null)} style={{display:'flex',alignItems:'center',gap:5,padding:'7px 12px',borderRadius:8,border:'none',background:'var(--bg-3)',color:'var(--tx-2)',fontSize:12,fontWeight:500,cursor:'pointer'}}>{I.back}<span className="hide-mobile">All Artists</span></button>}
          </div>
          <div style={{display:'flex',alignItems:'center',gap:10}}>
            {lastUpdated&&<span style={{fontSize:10,color:'var(--tx-3)',display:'flex',alignItems:'center',gap:4}} className="hide-mobile">{I.clock}Updated {timeAgo(lastUpdated)}</span>}
            {!sel&&<div style={{position:'relative'}} className="hide-mobile"><span style={{position:'absolute',left:10,top:'50%',transform:'translateY(-50%)',color:'var(--tx-3)'}}>{I.search}</span><input type="text" placeholder="Search..." value={search} onChange={e=>setSearch(e.target.value)} style={{width:140,padding:'9px 10px 9px 36px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-3)',color:'var(--tx-1)',fontSize:13}}/></div>}
            <button onClick={()=>setShowAdd(true)} style={{display:'flex',alignItems:'center',gap:5,padding:'9px 14px',borderRadius:8,border:'none',background:'var(--acc)',color:'#fff',fontSize:12,fontWeight:600,cursor:'pointer'}}>{I.plus}<span className="hide-mobile">Add</span></button>
            <button onClick={toggle} style={{display:'flex',alignItems:'center',justifyContent:'center',width:38,height:38,borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-3)',color:'var(--tx-2)',cursor:'pointer'}}>{theme==='dark'?I.sun:I.moon}</button>
          </div>
        </div>
      </header>

      {/* Main */}
      <main style={{maxWidth:1400,margin:'0 auto',padding:20}}>
        {sel?<Detail artist={artists.find(a=>a.id===sel.id)} onSave={save} onDel={()=>del(sel.id)} onBack={()=>setSel(null)} onStatClick={setStatsModal}/>:<Grid artists={sorted} onSelect={setSel} sortBy={sortBy} setSortBy={setSortBy} lastUpdated={lastUpdated}/>}
      </main>

      {showAdd&&<AddModal onClose={()=>setShowAdd(false)} onAdd={add} count={artists.length}/>}
      {statsModal&&<StatsModal title={statsModal.title} artist={statsModal.artist} type={statsModal.type} onClose={()=>setStatsModal(null)}/>}
    </div>
  );
}

// Artists Grid with last updated timestamp
function Grid({artists,onSelect,sortBy,setSortBy,lastUpdated}){
  return(
    <div className="fi">
      {/* Header with sort and timestamp */}
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:16,flexWrap:'wrap',gap:12}}>
        <div>
          <h2 style={{fontSize:16,fontWeight:600}}>Artists ({artists.length}/25)</h2>
          {lastUpdated&&<p style={{fontSize:11,color:'var(--tx-3)',marginTop:2,display:'flex',alignItems:'center',gap:4}}>{I.clock}Last scraped: {new Date(lastUpdated).toLocaleDateString()} {new Date(lastUpdated).toLocaleTimeString()}</p>}
        </div>
        <div style={{display:'flex',alignItems:'center',gap:8}}>
          <span style={{fontSize:12,color:'var(--tx-3)'}}>Sort:</span>
          <select value={sortBy} onChange={e=>setSortBy(e.target.value)}>
            <option value="streams">Total Streams</option>
            <option value="velocity">Daily Velocity</option>
            <option value="date">Date Added</option>
            <option value="name">Name</option>
            <option value="tiktok">TikTok Followers</option>
            <option value="ugc">TikTok UGC</option>
          </select>
        </div>
      </div>

      {/* Table */}
      {artists.length===0?(
        <div style={{padding:50,textAlign:'center',background:'var(--bg-2)',borderRadius:14,border:'1px solid var(--bd)'}}>
          <div style={{fontSize:40,marginBottom:12}}>ðŸŽ¤</div>
          <h3 style={{fontSize:16,marginBottom:6}}>No artists yet</h3>
          <p style={{color:'var(--tx-3)',fontSize:13}}>Click "Add" to start tracking</p>
        </div>
      ):(
        <div style={{background:'var(--bg-2)',borderRadius:14,border:'1px solid var(--bd)',overflow:'hidden'}}>
          {/* Table Header */}
          <div style={{display:'grid',gridTemplateColumns:'2fr 1fr 1fr 1fr 1fr 1fr 36px',gap:12,padding:'10px 16px',borderBottom:'1px solid var(--bd)',background:'var(--bg-3)',fontSize:10,fontWeight:600,color:'var(--tx-3)',textTransform:'uppercase',letterSpacing:'.5px'}} className="mobile-full">
            <span>Artist</span>
            <span style={{textAlign:'right'}} className="hide-mobile">Streams</span>
            <span style={{textAlign:'right'}} className="hide-mobile">Daily</span>
            <span style={{textAlign:'right'}} className="hide-mobile">TikTok</span>
            <span style={{textAlign:'right'}} className="hide-mobile">Instagram</span>
            <span style={{textAlign:'right'}} className="hide-mobile">UGC</span>
            <span className="hide-mobile"></span>
          </div>
          {/* Rows */}
          {artists.map((a,i)=><Row key={a.id} a={a} rank={i+1} onClick={()=>onSelect(a)}/>)}
        </div>
      )}
    </div>
  );
}

function Row({a,rank,onClick}){
  const ts=totStr(a),dv=dayStr(a),tu=totUGC(a);
  return(
    <div onClick={onClick} style={{display:'grid',gridTemplateColumns:'2fr 1fr 1fr 1fr 1fr 1fr 36px',gap:12,padding:'12px 16px',borderBottom:'1px solid var(--bd-l)',cursor:'pointer',transition:'background .12s'}} className="mobile-full" onMouseOver={e=>e.currentTarget.style.background='var(--bg-3)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
      <div style={{display:'flex',alignItems:'center',gap:10}}>
        <span style={{display:'flex',alignItems:'center',justifyContent:'center',width:26,height:26,borderRadius:7,background:rank<=3?'var(--org-l)':'var(--bg-3)',color:rank<=3?'var(--org)':'var(--tx-3)',fontSize:11,fontWeight:700}}>{rank}</span>
        <div>
          <div style={{fontWeight:600,fontSize:13}}>{a.n}</div>
          <div style={{fontSize:10,color:'var(--tx-3)'}}>{a.sg?.length||0} songs â€¢ {fmt(ts)} streams</div>
        </div>
      </div>
      <div className="mono hide-mobile" style={{textAlign:'right',fontWeight:600,fontSize:13,alignSelf:'center'}}>{fmt(ts)}</div>
      <div style={{textAlign:'right',alignSelf:'center'}} className="hide-mobile"><Delta v={dv} sz="sm"/></div>
      <div className="mono hide-mobile" style={{textAlign:'right',fontSize:12,color:'var(--tx-2)',alignSelf:'center'}}>{fmt(a.m?.tk||0)}</div>
      <div className="mono hide-mobile" style={{textAlign:'right',fontSize:12,color:'var(--tx-2)',alignSelf:'center'}}>{fmt(a.m?.ig||0)}</div>
      <div style={{textAlign:'right',alignSelf:'center'}} className="hide-mobile">
        {tu>0?<span className="mono" style={{display:'inline-flex',alignItems:'center',gap:3,padding:'3px 7px',borderRadius:5,background:tu>=1000?'var(--red-l)':'var(--prp-l)',color:tu>=1000?'var(--red)':'var(--prp)',fontSize:11,fontWeight:600}}>{tu>=1000&&I.fire}{fmt(tu)}</span>:<span style={{color:'var(--tx-3)',fontSize:12}}>â€”</span>}
      </div>
      <div style={{display:'flex',alignItems:'center',justifyContent:'center',color:'var(--tx-3)'}} className="hide-mobile">{I.chev}</div>
    </div>
  );
}

// Artist Detail with mobile-friendly UGC entry
function Detail({artist:a,onSave,onDel,onBack,onStatClick}){
  const[editSong,setEditSong]=useState(null);
  const[editUGC,setEditUGC]=useState(null);
  const[editIgUGC,setEditIgUGC]=useState(null);
  const[editIgUrl,setEditIgUrl]=useState(null);
  const[newTitle,setNewTitle]=useState('');
  const[newTkUrl,setNewTkUrl]=useState('');
  const[showAdd,setShowAdd]=useState(false);
  const[editLinks,setEditLinks]=useState(false);
  const[links,setLinks]=useState({});

  useEffect(()=>{if(a)setLinks(a.l||{})},[a]);

  if(!a)return null;

  const ts=totStr(a),tu=totUGC(a),dsv=dayStr(a),duv=dayUGC(a);
  const lastUpdated=getLastUpdated(a);

  const addSong=()=>{
    if(!newTitle.trim())return;
    const id='s'+Date.now();
    onSave({...a,sg:[...(a.sg||[]),{id,t:newTitle.trim(),tkUrl:newTkUrl.trim()}],sm:{...a.sm,[id]:{st:0,ug:0,igu:0,yt:0,h:{st:[],ug:[],igu:[],yt:[]}}}});
    setNewTitle('');setNewTkUrl('');setShowAdd(false);
  };

  const delSong=id=>{if(!confirm('Remove song?'))return;const{[id]:_,...rest}=a.sm||{};onSave({...a,sg:a.sg.filter(s=>s.id!==id),sm:rest})};

  const saveTkUrl=(id,url)=>{onSave({...a,sg:a.sg.map(s=>s.id===id?{...s,tkUrl:url}:s)});setEditSong(null)};
  
  const saveIgUrl=(id,url)=>{onSave({...a,sg:a.sg.map(s=>s.id===id?{...s,igUrl:url}:s)});setEditIgUrl(null)};

  const saveUGC=(id,count)=>{
    const val=parseInt(count)||0;
    const today=new Date().toISOString().split('T')[0];
    const sm={...a.sm};
    if(!sm[id])sm[id]={st:0,ug:0,igu:0,yt:0,h:{st:[],ug:[],igu:[],yt:[]}};
    sm[id].ug=val;
    if(!sm[id].h)sm[id].h={st:[],ug:[],igu:[],yt:[]};
    if(!sm[id].h.ug)sm[id].h.ug=[];
    sm[id].h.ug=[...(sm[id].h.ug||[]),{d:today,v:val}].slice(-90);
    onSave({...a,sm});
    setEditUGC(null);
  };
  
  const saveIgUGC=(id,count)=>{
    const val=parseInt(count)||0;
    const today=new Date().toISOString().split('T')[0];
    const sm={...a.sm};
    if(!sm[id])sm[id]={st:0,ug:0,igu:0,yt:0,h:{st:[],ug:[],igu:[],yt:[]}};
    sm[id].igu=val;
    if(!sm[id].h)sm[id].h={st:[],ug:[],igu:[],yt:[]};
    if(!sm[id].h.igu)sm[id].h.igu=[];
    sm[id].h.igu=[...(sm[id].h.igu||[]),{d:today,v:val}].slice(-90);
    onSave({...a,sm});
    setEditIgUGC(null);
  };

  const saveLinks=()=>{onSave({...a,l:links});setEditLinks(false)};

  // Convert TikTok web URL to app deep link
  const getTikTokAppLink=(url)=>{
    if(!url)return null;
    // TikTok app can open web URLs directly
    return url;
  };

  return(
    <div className="fi">
      {/* Header */}
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:20,flexWrap:'wrap',gap:12}}>
        <div>
          <h1 style={{fontSize:24,fontWeight:800,marginBottom:6}}>{a.n}</h1>
          {lastUpdated&&<p style={{fontSize:11,color:'var(--tx-3)',marginBottom:10,display:'flex',alignItems:'center',gap:4}}>{I.clock}Updated {timeAgo(lastUpdated)}</p>}
          {!editLinks?(
            <div style={{display:'flex',gap:6,flexWrap:'wrap',alignItems:'center'}}>
              {Object.entries(a.l||{}).filter(([_,u])=>u).map(([p,u])=><PBadge key={p} p={p} url={u}/>)}
              <button onClick={()=>setEditLinks(true)} style={{display:'flex',alignItems:'center',gap:4,padding:'5px 9px',borderRadius:7,border:'1px dashed var(--bd)',background:'transparent',color:'var(--tx-3)',fontSize:11,cursor:'pointer'}}>{I.edit}Edit</button>
            </div>
          ):(
            <div style={{background:'var(--bg-3)',padding:12,borderRadius:10,marginTop:8}}>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginBottom:10}} className="mobile-full">
                {[['sp','Spotify'],['tk','TikTok'],['ig','Instagram'],['yt','YouTube'],['am','Apple Music']].map(([k,l])=>(
                  <div key={k}>
                    <label style={{fontSize:10,color:'var(--tx-3)',display:'block',marginBottom:3}}>{l}</label>
                    <input value={links[k]||''} onChange={e=>setLinks({...links,[k]:e.target.value})} placeholder={`${l} URL`} style={{width:'100%',padding:'7px 9px',borderRadius:6,border:'1px solid var(--bd)',background:'var(--bg-2)',color:'var(--tx-1)',fontSize:11}}/>
                  </div>
                ))}
              </div>
              <div style={{display:'flex',gap:8}}>
                <button onClick={saveLinks} style={{padding:'7px 14px',borderRadius:6,border:'none',background:'var(--grn)',color:'#fff',fontSize:11,fontWeight:600,cursor:'pointer'}}>Save</button>
                <button onClick={()=>{setLinks(a.l||{});setEditLinks(false)}} style={{padding:'7px 12px',borderRadius:6,border:'1px solid var(--bd)',background:'transparent',color:'var(--tx-3)',fontSize:11,cursor:'pointer'}}>Cancel</button>
              </div>
            </div>
          )}
        </div>
        <button onClick={onDel} style={{display:'flex',alignItems:'center',gap:5,padding:'8px 14px',borderRadius:8,border:'1px solid var(--red)',background:'var(--red-l)',color:'var(--red)',fontSize:12,fontWeight:500,cursor:'pointer'}}>{I.trash}<span className="hide-mobile">Remove</span></button>
      </div>

      {/* Stats - Clickable */}
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(130px,1fr))',gap:10,marginBottom:24}}>
        <Stat label="Total Streams" value={fmt(ts)} delta={dsv} color="var(--grn)" onClick={()=>onStatClick({title:'Total Streams',artist:a,type:'streams'})}/>
        <Stat label="Monthly Listeners" value={fmt(a.m?.ml||0)} icon={I.sp} spark={a.h?.ml?.slice(-14)} color="#1DB954" onClick={()=>onStatClick({title:'Monthly Listeners',artist:a,type:'monthly'})}/>
        <Stat label="TikTok" value={fmt(a.m?.tk||0)} spark={a.h?.tk?.slice(-14)} color="var(--tx-1)" onClick={()=>onStatClick({title:'TikTok',artist:a,type:'tiktok'})}/>
        <Stat label="Instagram" value={fmt(a.m?.ig||0)} spark={a.h?.ig?.slice(-14)} color="#E1306C" onClick={()=>onStatClick({title:'Instagram',artist:a,type:'instagram'})}/>
        <Stat label="YouTube" value={fmt(a.m?.yt||0)} icon={I.yt} spark={a.h?.yt?.slice(-14)} color="#FF0000" onClick={()=>onStatClick({title:'YouTube',artist:a,type:'youtube'})}/>
        <Stat label="Total UGC" value={fmt(tu)} delta={duv} color="var(--prp)" onClick={()=>onStatClick({title:'TikTok & Instagram UGC',artist:a,type:'ugc'})}/>
        <Stat label="Social Score" value={a.m?.ss||'â€”'} color="var(--acc)" onClick={()=>onStatClick({title:'Social Score',artist:a,type:'social'})}/>
      </div>

      {/* Songs */}
      <div style={{background:'var(--bg-2)',borderRadius:14,border:'1px solid var(--bd)',overflow:'hidden'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'14px 16px',borderBottom:'1px solid var(--bd)'}}>
          <div><h2 style={{fontSize:14,fontWeight:600}}>Songs</h2><p style={{fontSize:11,color:'var(--tx-3)'}}>{a.sg?.length||0} tracks â€¢ Tap UGC to update</p></div>
          <button onClick={()=>setShowAdd(true)} style={{display:'flex',alignItems:'center',gap:4,padding:'7px 12px',borderRadius:7,border:'none',background:'var(--acc)',color:'#fff',fontSize:12,fontWeight:500,cursor:'pointer'}}>{I.plus}</button>
        </div>

        {/* Add Song Form */}
        {showAdd&&(
          <div style={{padding:14,borderBottom:'1px solid var(--bd)',background:'var(--bg-3)'}}>
            <input type="text" placeholder="Song title" value={newTitle} onChange={e=>setNewTitle(e.target.value)} autoFocus style={{width:'100%',padding:'10px 12px',borderRadius:7,border:'1px solid var(--bd)',background:'var(--bg-2)',color:'var(--tx-1)',fontSize:13,marginBottom:8}}/>
            <div style={{display:'flex',gap:8}}>
              <input type="text" placeholder="TikTok Sound URL (optional)" value={newTkUrl} onChange={e=>setNewTkUrl(e.target.value)} style={{flex:1,padding:'9px 12px',borderRadius:7,border:'1px solid var(--bd)',background:'var(--bg-2)',color:'var(--tx-1)',fontSize:12}}/>
              <button onClick={addSong} style={{padding:'9px 16px',borderRadius:7,border:'none',background:'var(--grn)',color:'#fff',fontWeight:600,fontSize:12,cursor:'pointer'}}>Add</button>
              <button onClick={()=>{setShowAdd(false);setNewTitle('');setNewTkUrl('')}} style={{padding:'9px 12px',borderRadius:7,border:'1px solid var(--bd)',background:'transparent',color:'var(--tx-3)',cursor:'pointer'}}>âœ•</button>
            </div>
          </div>
        )}

        {/* Songs List */}
        {(!a.sg||a.sg.length===0)?(
          <div style={{padding:36,textAlign:'center',color:'var(--tx-3)',fontSize:13}}>No songs yet. Add Spotify link and run scraper.</div>
        ):(
          <div>
            {/* Table Header - Desktop */}
            <div className="hide-mobile" style={{display:'grid',gridTemplateColumns:'2.5fr 1fr 1fr 140px 140px 36px',gap:8,padding:'10px 16px',background:'var(--bg-3)',fontSize:9,fontWeight:600,color:'var(--tx-3)',textTransform:'uppercase',letterSpacing:'.5px'}}>
              <span>Title</span>
              <span style={{textAlign:'right'}}>Streams</span>
              <span style={{textAlign:'right'}}>Daily</span>
              <span style={{textAlign:'center'}}>TikTok</span>
              <span style={{textAlign:'center'}}>Instagram</span>
              <span></span>
            </div>
            {a.sg.map(s=>{
              const m=a.sm?.[s.id]||{};
              const isYouTube = s.src === 'yt';
              const streams = isYouTube ? (m.yt||0) : (m.st||0);
              const daily = isYouTube ? vel(m.h?.yt,1) : vel(m.h?.st,1);
              return(
                <div key={s.id} style={{borderTop:'1px solid var(--bd-l)'}}>
                  {/* Desktop Row */}
                  <div className="hide-mobile" style={{display:'grid',gridTemplateColumns:'2.5fr 1fr 1fr 140px 140px 36px',gap:8,padding:'12px 16px',alignItems:'center'}}>
                    <div style={{display:'flex',alignItems:'center',gap:8}}>
                      {isYouTube ? I.yt : I.sp}
                      <div style={{fontWeight:500,fontSize:13,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{s.t}</div>
                    </div>
                    <div className="mono" style={{textAlign:'right',fontWeight:600,fontSize:13}}>{fmt(streams)}</div>
                    <div style={{textAlign:'right'}}><Delta v={daily} sz="sm"/></div>
                    
                    {/* TikTok Group: UGC + Sound */}
                    <div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'center'}}>
                      {!isYouTube ? (
                        <>
                          {editUGC===s.id?(
                            <input type="number" defaultValue={m.ug||0} style={{width:45,padding:'4px',borderRadius:5,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:11,textAlign:'center'}} onKeyDown={e=>{if(e.key==='Enter')saveUGC(s.id,e.target.value);if(e.key==='Escape')setEditUGC(null)}} onBlur={e=>saveUGC(s.id,e.target.value)} autoFocus/>
                          ):(
                            <button onClick={()=>setEditUGC(s.id)} className="mono" title="TikTok UGC" style={{padding:'4px 6px',borderRadius:5,border:'1px solid var(--bd)',background:m.ug>0?'var(--prp-l)':'transparent',color:m.ug>0?'var(--prp)':'var(--tx-3)',fontSize:11,fontWeight:600,cursor:'pointer',minWidth:32}}>{m.ug||'â€”'}</button>
                          )}
                          {editSong===s.id?(
                            <div style={{display:'flex',gap:2}}>
                              <input type="text" defaultValue={s.tkUrl||''} placeholder="URL" style={{width:55,padding:'4px',borderRadius:5,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:9}} onKeyDown={e=>{if(e.key==='Enter')saveTkUrl(s.id,e.target.value);if(e.key==='Escape')setEditSong(null)}} autoFocus/>
                              <button onClick={e=>saveTkUrl(s.id,e.target.previousSibling.value)} style={{padding:'4px 6px',borderRadius:4,border:'none',background:'var(--grn)',color:'#fff',fontSize:9,cursor:'pointer'}}>âœ“</button>
                            </div>
                          ):(
                            <button onClick={()=>setEditSong(s.id)} title="TikTok Sound Link" style={{padding:'4px 6px',borderRadius:5,border:'1px solid var(--bd)',background:s.tkUrl?'var(--grn-l)':'transparent',color:s.tkUrl?'var(--grn)':'var(--tx-3)',fontSize:10,cursor:'pointer'}}>{s.tkUrl?'ðŸŽµ':'+'}</button>
                          )}
                        </>
                      ) : <span style={{color:'var(--tx-3)',fontSize:10}}>â€”</span>}
                    </div>
                    
                    {/* Instagram Group: UGC + Sound */}
                    <div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'center'}}>
                      {!isYouTube ? (
                        <>
                          {editIgUGC===s.id?(
                            <input type="number" defaultValue={m.igu||0} style={{width:45,padding:'4px',borderRadius:5,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:11,textAlign:'center'}} onKeyDown={e=>{if(e.key==='Enter')saveIgUGC(s.id,e.target.value);if(e.key==='Escape')setEditIgUGC(null)}} onBlur={e=>saveIgUGC(s.id,e.target.value)} autoFocus/>
                          ):(
                            <button onClick={()=>setEditIgUGC(s.id)} className="mono" title="Instagram Reels UGC" style={{padding:'4px 6px',borderRadius:5,border:'1px solid var(--bd)',background:m.igu>0?'#E1306C22':'transparent',color:m.igu>0?'#E1306C':'var(--tx-3)',fontSize:11,fontWeight:600,cursor:'pointer',minWidth:32}}>{m.igu||'â€”'}</button>
                          )}
                          {editIgUrl===s.id?(
                            <div style={{display:'flex',gap:2}}>
                              <input type="text" defaultValue={s.igUrl||''} placeholder="URL" style={{width:55,padding:'4px',borderRadius:5,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:9}} onKeyDown={e=>{if(e.key==='Enter')saveIgUrl(s.id,e.target.value);if(e.key==='Escape')setEditIgUrl(null)}} autoFocus/>
                              <button onClick={e=>saveIgUrl(s.id,e.target.previousSibling.value)} style={{padding:'4px 6px',borderRadius:4,border:'none',background:'#E1306C',color:'#fff',fontSize:9,cursor:'pointer'}}>âœ“</button>
                            </div>
                          ):(
                            <button onClick={()=>setEditIgUrl(s.id)} title="Instagram Sound Link" style={{padding:'4px 6px',borderRadius:5,border:'1px solid var(--bd)',background:s.igUrl?'#E1306C22':'transparent',color:s.igUrl?'#E1306C':'var(--tx-3)',fontSize:10,cursor:'pointer'}}>{s.igUrl?'ðŸ“·':'+'}</button>
                          )}
                        </>
                      ) : <span style={{color:'var(--tx-3)',fontSize:10}}>â€”</span>}
                    </div>
                    
                    <div style={{textAlign:'center'}}>
                      <button onClick={()=>delSong(s.id)} style={{padding:4,borderRadius:5,border:'none',background:'transparent',color:'var(--tx-3)',cursor:'pointer'}}>{I.trash}</button>
                    </div>
                  </div>

                  {/* Mobile Row */}
                  <div className="show-mobile" style={{padding:'12px 16px'}}>
                    <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:10}}>
                      <div style={{flex:1,minWidth:0}}>
                        <div style={{display:'flex',alignItems:'center',gap:6,fontWeight:500,fontSize:14,marginBottom:4}}>
                          {isYouTube ? I.yt : I.sp}
                          <span style={{overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{s.t}</span>
                        </div>
                        <div style={{display:'flex',alignItems:'center',gap:6,flexWrap:'wrap'}}>
                          <span className="mono" style={{fontSize:12,color:'var(--tx-2)'}}>{fmt(streams)} {isYouTube?'views':'streams'}</span>
                          <Delta v={daily} sz="sm"/>
                        </div>
                      </div>
                      <button onClick={()=>delSong(s.id)} style={{padding:6,borderRadius:5,border:'none',background:'transparent',color:'var(--tx-3)',cursor:'pointer'}}>{I.trash}</button>
                    </div>
                    {!isYouTube && (
                      <div style={{display:'flex',flexDirection:'column',gap:8}}>
                        {/* TikTok Section */}
                        <div style={{background:'var(--bg-3)',borderRadius:10,padding:10}}>
                          <div style={{fontSize:10,fontWeight:600,color:'var(--tx-3)',marginBottom:6,textTransform:'uppercase',letterSpacing:'.5px'}}>TikTok</div>
                          <div style={{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}}>
                            {editUGC===s.id?(
                              <div style={{display:'flex',gap:4,flex:1}}>
                                <input type="number" defaultValue={m.ug||0} placeholder="UGC count" style={{flex:1,padding:'10px 12px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:14}} onKeyDown={e=>{if(e.key==='Enter')saveUGC(s.id,e.target.value);if(e.key==='Escape')setEditUGC(null)}} autoFocus/>
                                <button onClick={e=>saveUGC(s.id,e.target.previousSibling.value)} style={{padding:'10px 14px',borderRadius:8,border:'none',background:'var(--prp)',color:'#fff',fontSize:12,fontWeight:600,cursor:'pointer'}}>Save</button>
                              </div>
                            ):(
                              <button onClick={()=>setEditUGC(s.id)} style={{display:'flex',alignItems:'center',gap:6,padding:'10px 14px',borderRadius:8,border:'1px solid var(--bd)',background:m.ug>0?'var(--prp-l)':'var(--bg-2)',color:m.ug>0?'var(--prp)':'var(--tx-2)',fontSize:13,fontWeight:600,cursor:'pointer'}}>
                                UGC: <span className="mono">{fmt(m.ug||0)}</span>
                              </button>
                            )}
                            {editSong===s.id?(
                              <div style={{display:'flex',gap:4,flex:1}}>
                                <input type="text" defaultValue={s.tkUrl||''} placeholder="TikTok sound URL" style={{flex:1,padding:'10px 12px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:12}} onKeyDown={e=>{if(e.key==='Enter')saveTkUrl(s.id,e.target.value);if(e.key==='Escape')setEditSong(null)}} autoFocus/>
                                <button onClick={e=>saveTkUrl(s.id,e.target.previousSibling.value)} style={{padding:'10px 14px',borderRadius:8,border:'none',background:'var(--grn)',color:'#fff',fontSize:12,fontWeight:600,cursor:'pointer'}}>Save</button>
                              </div>
                            ):(
                              s.tkUrl?(
                                <div style={{display:'flex',gap:4,flex:1}}>
                                  <a href={s.tkUrl} target="_blank" rel="noopener" style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',gap:6,padding:'10px 14px',borderRadius:8,background:'var(--grn-l)',color:'var(--grn)',fontSize:12,fontWeight:600,textDecoration:'none'}}>ðŸŽµ Open Sound</a>
                                  <button onClick={()=>setEditSong(s.id)} style={{padding:'10px',borderRadius:8,border:'1px solid var(--bd)',background:'transparent',color:'var(--tx-3)',cursor:'pointer'}}>{I.edit}</button>
                                </div>
                              ):(
                                <button onClick={()=>setEditSong(s.id)} style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',gap:4,padding:'10px 14px',borderRadius:8,border:'1px dashed var(--bd)',background:'transparent',color:'var(--tx-3)',fontSize:12,cursor:'pointer'}}>+ Add Sound Link</button>
                              )
                            )}
                          </div>
                        </div>
                        
                        {/* Instagram Section */}
                        <div style={{background:'var(--bg-3)',borderRadius:10,padding:10}}>
                          <div style={{fontSize:10,fontWeight:600,color:'var(--tx-3)',marginBottom:6,textTransform:'uppercase',letterSpacing:'.5px'}}>Instagram Reels</div>
                          <div style={{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}}>
                            {editIgUGC===s.id?(
                              <div style={{display:'flex',gap:4,flex:1}}>
                                <input type="number" defaultValue={m.igu||0} placeholder="Reels count" style={{flex:1,padding:'10px 12px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:14}} onKeyDown={e=>{if(e.key==='Enter')saveIgUGC(s.id,e.target.value);if(e.key==='Escape')setEditIgUGC(null)}} autoFocus/>
                                <button onClick={e=>saveIgUGC(s.id,e.target.previousSibling.value)} style={{padding:'10px 14px',borderRadius:8,border:'none',background:'#E1306C',color:'#fff',fontSize:12,fontWeight:600,cursor:'pointer'}}>Save</button>
                              </div>
                            ):(
                              <button onClick={()=>setEditIgUGC(s.id)} style={{display:'flex',alignItems:'center',gap:6,padding:'10px 14px',borderRadius:8,border:'1px solid var(--bd)',background:m.igu>0?'#E1306C22':'var(--bg-2)',color:m.igu>0?'#E1306C':'var(--tx-2)',fontSize:13,fontWeight:600,cursor:'pointer'}}>
                                UGC: <span className="mono">{fmt(m.igu||0)}</span>
                              </button>
                            )}
                            {editIgUrl===s.id?(
                              <div style={{display:'flex',gap:4,flex:1}}>
                                <input type="text" defaultValue={s.igUrl||''} placeholder="Instagram audio URL" style={{flex:1,padding:'10px 12px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-1)',color:'var(--tx-1)',fontSize:12}} onKeyDown={e=>{if(e.key==='Enter')saveIgUrl(s.id,e.target.value);if(e.key==='Escape')setEditIgUrl(null)}} autoFocus/>
                                <button onClick={e=>saveIgUrl(s.id,e.target.previousSibling.value)} style={{padding:'10px 14px',borderRadius:8,border:'none',background:'#E1306C',color:'#fff',fontSize:12,fontWeight:600,cursor:'pointer'}}>Save</button>
                              </div>
                            ):(
                              s.igUrl?(
                                <div style={{display:'flex',gap:4,flex:1}}>
                                  <a href={s.igUrl} target="_blank" rel="noopener" style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',gap:6,padding:'10px 14px',borderRadius:8,background:'#E1306C22',color:'#E1306C',fontSize:12,fontWeight:600,textDecoration:'none'}}>ðŸ“· Open Audio</a>
                                  <button onClick={()=>setEditIgUrl(s.id)} style={{padding:'10px',borderRadius:8,border:'1px solid var(--bd)',background:'transparent',color:'var(--tx-3)',cursor:'pointer'}}>{I.edit}</button>
                                </div>
                              ):(
                                <button onClick={()=>setEditIgUrl(s.id)} style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',gap:4,padding:'10px 14px',borderRadius:8,border:'1px dashed var(--bd)',background:'transparent',color:'var(--tx-3)',fontSize:12,cursor:'pointer'}}>+ Add Audio Link</button>
                              )
                            )}
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

// Add Artist Modal
function AddModal({onClose,onAdd,count}){
  const[f,setF]=useState({n:'',sp:'',tk:'',ig:'',yt:'',am:''});

  const submit=()=>{
    if(!f.n.trim()){alert('Name required');return}
    onAdd({n:f.n.trim(),da:new Date().toISOString().split('T')[0],l:{sp:f.sp,tk:f.tk,ig:f.ig,yt:f.yt,am:f.am},m:{sf:0,ml:0,tk:0,ig:0,yt:0,tp:0,ip:0,ss:0}});
  };

  return(
    <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,.55)',backdropFilter:'blur(4px)',display:'flex',alignItems:'center',justifyContent:'center',padding:16,zIndex:1000}}>
      <div style={{width:'100%',maxWidth:440,background:'var(--bg-2)',borderRadius:14,border:'1px solid var(--bd)',overflow:'hidden'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'14px 18px',borderBottom:'1px solid var(--bd)'}}>
          <h2 style={{fontSize:16,fontWeight:600}}>Add Artist</h2>
          <button onClick={onClose} style={{padding:6,borderRadius:6,border:'none',background:'var(--bg-3)',color:'var(--tx-3)',cursor:'pointer'}}>{I.x}</button>
        </div>
        <div style={{padding:18,maxHeight:'60vh',overflow:'auto'}}>
          <p style={{fontSize:11,color:'var(--tx-3)',marginBottom:14}}>{count}/25 artists</p>
          <div style={{marginBottom:14}}>
            <label style={{display:'block',fontSize:11,fontWeight:500,color:'var(--tx-2)',marginBottom:5}}>Artist Name *</label>
            <input type="text" value={f.n} onChange={e=>setF({...f,n:e.target.value})} placeholder="Enter name" style={{width:'100%',padding:'11px 13px',borderRadius:8,border:'1px solid var(--bd)',background:'var(--bg-3)',color:'var(--tx-1)',fontSize:13}}/>
          </div>
          <p style={{fontSize:10,color:'var(--tx-3)',marginBottom:10,padding:8,background:'var(--bg-3)',borderRadius:6}}>ðŸ’¡ Add platform links to track followers and metrics. Use the Chrome extension to capture data.</p>
          {[['sp','Spotify',I.sp,'open.spotify.com/artist/...'],['tk','TikTok',I.tk,'tiktok.com/@...'],['ig','Instagram',I.ig,'instagram.com/...'],['yt','YouTube',I.yt,'youtube.com/@...'],['am','Apple Music',I.am,'music.apple.com/artist/...']].map(([k,l,ic,ph])=>(
            <div key={k} style={{marginBottom:10}}>
              <label style={{display:'flex',alignItems:'center',gap:5,fontSize:11,fontWeight:500,color:'var(--tx-2)',marginBottom:5}}>{ic}{l}</label>
              <input type="text" value={f[k]} onChange={e=>setF({...f,[k]:e.target.value})} placeholder={`https://${ph}`} style={{width:'100%',padding:'9px 11px',borderRadius:7,border:'1px solid var(--bd)',background:'var(--bg-3)',color:'var(--tx-1)',fontSize:12}}/>
            </div>
          ))}
        </div>
        <div style={{display:'flex',gap:10,padding:'14px 18px',borderTop:'1px solid var(--bd)'}}>
          <button onClick={onClose} style={{flex:1,padding:'11px 14px',borderRadius:8,border:'1px solid var(--bd)',background:'transparent',color:'var(--tx-2)',fontSize:13,fontWeight:500,cursor:'pointer'}}>Cancel</button>
          <button onClick={submit} style={{flex:1,padding:'11px 14px',borderRadius:8,border:'none',background:'var(--acc)',color:'#fff',fontSize:13,fontWeight:600,cursor:'pointer'}}>Add Artist</button>
        </div>
      </div>
    </div>
  );
}

// Render
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
